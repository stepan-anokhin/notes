# Весёлая теоремка

Ниже приводится доказательство Теоремы, которая обобщает следующую очевидную идею: пусть у нас имеется алгебраическая система c набором операций. 
Если некоторое свойство $P$ присуще всем элементам $A$, и алгебраические операции сохраняют данное свойство, то 
$P$ будет также присуще и всем элементам замыкания 
$A$ относительно операций. Это утверждение кажется очевидным. 

В случае, когда операторы - это функции с конечным числом аргументов данный вопрос решается тривиально. Пусть $A^*$ - это всевозможные значения, получающиеся в результате применения операций к элементам $A$ алгебраических операций конечное число раз. Легко показать, что $A^*$ - и есть замыкание (минимально замкнутое множество, содержащее $A$).
Поскольку каждый $A^{*}$ можно представить как результат применения алгебраических операций к элементам $A$, то выполнение 
$P$ на $A^*$ доказывается как тривиальная индукция по наименьшему числу операций, необходимых для получения данного элемента.  

Ситуация усложняется, если мы разрешаем операторам иметь произвольное бесконечное число аргументов (счётное и более). В этом случае простая индукция не годится, поскольку количество операций, необходимых для получения данного элемента замыкания из исходных значений $A$ может также быть произвольно большим. 

Доказательство интересующего нас утверждения в наиболее общем случае (для операций с бесконечным числом аргументов) требует трансфинитной индукции, но во всём остальном следует идее, изложенной для случая операций с конечным числом аргументов. Для начала, правда, следует уточнить понятия "операции с бесконечным числом аргументов", "замыкания" и т.д.

## Определения
**Определение 1.1**: Пусть задано некоторое множество $X$ и множество $T$ произвольной мощности $\tau$. *Последовательностью* $\{x_{\alpha}\}$ будем называть любую функцию $f:T\rightarrow X$, которая каждому $\alpha$ из $T$ ставит в соответствие некоторый элемент $x_\alpha$ из $X$. Множество всех таких последовательностей будем обозначать $X^{T}$. 

**Определение 1.2**: В условиях определения 1.1 множество $T$ будем называть *множеством индексов* последовательности $\{x_{\alpha}\}$.

**Определение 1.3**: В условиях определения 1.1 мощность $\tau = |T|$ будем называть *длиной* последовательности $x=\{x_{\alpha}\}$, а также *количеством элементов* последовательности $x$.

**Определение 2.1**: Пусть $\tau=|T|$. Тогда $\tau$-*арной* перацией над множеством X будем называть любую функцию $f:X^{T}\rightarrow X$, которая отображает последовательности $\{x_{\alpha}\}$ из $X^T$ в $X$. 

**Определение 2.2**: Длину последовательностей из $X^T$ будем также называть *арностью* операции $f$. 

**Определение 3.1**: Пусть на множестве $X$ задана операция $f:X^T\rightarrow X$. 

**Определение 3.2**: Будем говорить, что подмножество $A\subseteq X$ *замкнуто относительно* $f$, если для любого набора аргументов $x$ из $A^T$ результат применения операции $f(x)$ будет также содержаться в $A$: $f(A^T)\subseteq A$. 

**Определение 3.3**: Будем говорить, что множество $A$ *замкнуто относительно набора оперций* $f_1,...,f_n$, если $A$ замкнуто относительно каждой операции $f_i$, а именно $\forall i \in[1, n]: f_i(A^{T_i})\subseteq A$. 

**Определение 3.4**: *Замыканием* множества $A\subseteq X$ относительно операций $f_1,...,f_n$ будем называть наименьшее множество $[A]_{f_1,...,fn}^{*}\subseteq X$ замкнутое относительно $f_1,...,f_n$ и содержащее $A$: $\forall B \subseteq X$, если $A \subseteq B$ и $B$ замкнуто относительно $f_1, ...., f_n$, то $[A]_{f_1,...,fn}^{*} \subseteq B$. В случае, когда набор функций $f_1,...,f_n$ ясен из контекста, будем просто писать $[A]^{*}$

**Определение 3.5**: *Однократным замыканием* множества $A$ относительно операций $f_1,...,f_n$ будем называть множество $[A]_{f_1,...,f_n}\subseteq X$, содержащее $A$ и результаты однократного применения операций $f_i$. Более точно $[A]_{f_1,...,f_n}=A\cup\bigcup_{i\in[1,n]}f_i(A^{T_i})$. Если набор операций $f_i$ ясен из контекста, будем просто писать $[A]$.

**Определение 4.1**: *Свойством* элементов множества $X$ будет называть любую функцию $P:X\rightarrow \{true, false\}$ принимающую на элементах $X$ значения из $\{true, false\}$. 

**Определение 4.2**: *Областью истинности* $Tr(P)\subseteq X$ будем называть множество элементов $X$ на которых $P$ принимает значение $true$, а именно $Tr(P) = P^{-1}(\{true\})$. 

**Определение 5**: Будем говорить, что набор операций $f_i:X^{T_i}\rightarrow X$ *сохраняет свойство* $P$, если область истинности $Tr(P)$ замкнута относительно $f_i$.

## Теорема

**Теорема**: Пусть задано произвольное множество $X$ с конечным набором операций $f_1,f_2,...f_n$ произвольной арности. Пусть $G\subset X$ - некоторое подмножество $X$ на котором выполняется свойство $P$. Если $f_i$ сохраняют свойство $P$, то это свойство выполняется на всех элементах замыкания $[G]^{*}$ относительно операций $f_i$.

**Доказательство**:
Пусть $\Phi$ - это такой кардинал, что $\Phi>|X|$. Мы хотим "расслоить" $[G]^*$ на набор попарно непересекающихся множеств $G_{\alpha}$, где индексы $\alpha$ - это ординальные числа из $\Phi$: 

$$
\begin{equation}
[G]^*=\bigcup_{\alpha \in \Phi}G_{\alpha}
\end{equation}
$$

Наша цель - сделать это таким образом, чтобы элементы каждого "слоя" $G_\alpha$ получались в результате однократного применения операций $f_i$ к элементам из "нижних" слоёв. 

Положим, по определению:

$$
\begin{equation}
G_0 = G
\end{equation}
$$

Далее, предположим, что для всех $\alpha'<\alpha$ множества $G_\alpha$ уже построены. Тогда положим по определению:

$$
\begin{equation}
G_{<\alpha}^*=\bigcup_{\alpha'<\alpha}G_{\alpha'}
\end{equation}
$$

$$
\begin{equation}
G_{\alpha} = [G_{<\alpha}^*] \setminus G_{<\alpha}^*
\end{equation}
$$

$$
\begin{equation}
G_{\alpha}^* = G_{<\alpha}^* \cup G_\alpha
\end{equation}
$$

И наконец обозначим объединение всех слоёв: 

$$
\begin{equation}
G^* = \bigcup_{\alpha \in \Phi} G_\alpha
\end{equation}
$$

Теперь наша промежуточная цель состоит в том, чтобы показать, что определенная таким образом $G^*$ совпадает с искомым замыканием $[G]^*$. Для этого нам понадобится среди прочего показать, что $G^*$ замкнуто относительно операций $f_i$. Трудность заключается в том, что число аргументов операций $f_i$ может быть произвольно большим. Как убедиться в том, что построив все слои $G_\alpha$ мы исчерпали все возможные значения, которые могут принимать $f_i(x)$ на всевозможных последовательностях из элементов $G^*$? Для этого-то мы и выбрали количество слоёв $\Phi$ настолько большим ($\Phi > |X|$). Это гарантирует нам, что на некотором шаге процесс добавления новых значений остановится и все последующие слои окажутся пустыми. Следующие 2 леммы доказывают это утверждение: 

**Лемма 1**: Существует такое $\xi \in \Phi$, что $G_\xi = \varnothing$.

**Доказательство**: Предположим обратное, и $G_\alpha \not = \varnothing$ для любого $\alpha \in \Phi$. Тогда пусть $h$ - это функция выбора, определенная на множестве слоёв $\{G_0, G_1, ..., G_\alpha, ...\}, \alpha \in \Phi$. Поскольку слои попарно не пересекаются, то $h(G_\alpha) \not = h(G_\beta)$ при $\alpha \not = \beta$. Тогда сопоставляя каждому $\alpha \in \Phi$ значение $h(G_\alpha)$ получим разно-значное отображение из $\Phi$ в $X$, что противоречит выбору $\Phi > |X|$. $\square$

**Лемма 2**: Если $G_\alpha = \varnothing$, то $G_{\alpha'} = \varnothing$ для всех $\alpha' > \alpha$.

**Доказательство**: Предположим обратное, и $\beta \in \Phi$ - это наименьший такой ординал, что $\beta > \alpha$ и $G_{\beta} \not = \varnothing$. Поскольку $G_{\alpha'} = \varnothing$ для всех промежуточных $\alpha < \alpha' < \beta$, то $G_{<\beta}^* = G_{<\alpha}^*$. Поскольку $G_{\beta} \not = \varnothing$, то существует $x \in G_{\beta}$, но тогда в силу определения (4) и равенства $G_{<\beta}^* = G_{<\alpha}^*$ выясняется, что $x \in  [G_{<\beta}^*] \setminus G_{<\beta}^*= [G_{<\alpha}^*] \setminus G_{<\alpha}^* = G_\alpha$, откуда следует, что $G_\alpha \not = \varnothing$. Полученное противоречие завершает докательство леммы. $\square$

Следующие 2 леммы завершают доказательство того, что $G^*=[G]^*$. 

**Лемма 3 (замкнутость)**: $G^*$ замкнуто относительно операций $f_i$.

**Доказательство**: Пусть $\xi \in \Phi$ - это наименьший такой ординал, что $G_\xi = \varnothing$. $\xi$ существует в силу Леммы 1. Тогда в силу Леммы 2 получим $G^*=G_{<\xi}^*$ (все более высокие слои пусты). Предположим, что для некоторой операции $f_i$ и некоторой последовательности $x \in (G_{<\xi}^*)^{T_i}$ значение $f_i(x)$ лежит за пределами $G_{<\xi}^*$. Но тогда оно принадлежало бы $G_{\xi}$, что противоречит выбору $\xi$. Полученное противоречие завершает докательство Леммы 3. $\square$

**Лемма 4 (минимальность)**: $G^*$ - является наименьшим множеством замкнутым относительно операций $f_i$.

**Доказательство**: Предположим, что $G^*$ не является наименьшим множеством замкнутым относительно операций $f_i$. Тогда найдётся такое $G'$, содержащее $G$ и замкнутое относительно операций $f_i$, что $G^* \not \subseteq G'$. Пусть $\alpha$ - это наименьший такой ординал, что слой $G_\alpha$ содержит элемент $x$, отсутствующий в $G'$. Возможны 2 случая:
 1. Если $\alpha = 0$, тогда $x \in G$. Но из этого слоедует, что $G\not \subseteq G'$ - противоречие с выбором $G'$. 
 2. Если  $\alpha > 0$. Но тогда для некоторой операции $f_i$ найдётся такая последовательность $z \in (G_{<\alpha}^*)^{T_i}$, что $x=f_i(z)$. Но в силу того, что $\alpha$ - наименьший такой ординал, получаем, что $z \in G'$, но тогда в силу замкнутости $G'$ получим, что $x \in G'$ - противоречие с выбором $x$. $\square$

Из Лемм 3-4 следует, что $G^*=[G]^*$. Таким образом, мы получили в своё распоряжение тот замечательный факт, что замыкание $[G]^*$ распадается на непересекающиеся слои $G_\alpha$, начиная с $G_0=G$, и заканчивая $G_\xi = \varnothing$, где каждый новый слой получается из предыдущих однократным применением операций $f_i$. Следующая лемма завершает доказательсво Теоремы. 

**Лемма 5 (сохранение свойства)**: Свойство $P$ (из условия Теоремы) выполняется на всех элементах $[G]^*$.

**Доказательство**: Предположим обратное. Пусть $\alpha$ - это наименьший такой ординал, что найдётся $x \in G_\alpha$, для которого $P(x) = false$. Возможны 2 случая:
 1.  Если $\alpha = 0$, тогда $x \in G_0 = G$, что противоречит тому, что $G\subseteq Tr(P)$ по условию Теоремы.
 2. Если  $\alpha > 0$, то для некоторой операции $f_i$ найдётся такая последовательность $z \in (G_{<\alpha}^*)^{T_i}$, что $x=f_i(z)$. В силу минимальности $\alpha$ имеем $P(z_j)=true$ для всех $j \in T_i$. Но тогда $P(x)=true$ поскольку $f_i$ сохраняют свойство $P$ по условию теоремы. Это противоречит выбору $x$. $\square$
